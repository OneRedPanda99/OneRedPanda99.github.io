<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-touch-fullscreen" content="yes">
    <title>Handwriting Data Collector</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        html, body {
            height: 100%;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 15px;
            width: 100%;
            height: 100%;
            max-width: 1024px;
            max-height: 768px;
            animation: slideUp 0.6s ease-out;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .header {
            text-align: center;
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .title {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 5px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .mode-selector {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .mode-btn {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #667eea;
            border-radius: 6px;
            background: white;
            color: #667eea;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
        }

        .progress-section {
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 0.8rem;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 3px;
        }

        .sentence-display {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            text-align: center;
            flex-shrink: 0;
            position: relative;
        }

        .sentence-text {
            font-size: 1.4rem;
            color: #333;
            line-height: 1.3;
            font-weight: 600;
        }

        .word-count {
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 0.7rem;
            color: #666;
            background: rgba(255,255,255,0.8);
            padding: 2px 6px;
            border-radius: 10px;
        }

        .canvas-container {
            border: 3px solid #667eea;
            border-radius: 8px;
            margin-bottom: 10px;
            background: white;
            position: relative;
            overflow: hidden;
            flex: 1;
            min-height: 150px;
        }

        #drawingCanvas, #guidelineCanvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
            touch-action: none;
        }

        .guidelines {
            pointer-events: none;
            opacity: 0.2;
        }

        .quick-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .quick-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }

        .quick-next {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            flex: 2;
        }

        .quick-clear {
            background: #6c757d;
            color: white;
        }

        .quick-skip {
            background: #ffc107;
            color: #212529;
        }

        .quick-btn:active {
            transform: scale(0.98);
        }

        .secondary-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 8px;
            flex-shrink: 0;
        }

        .btn {
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            flex-shrink: 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 6px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .stat-number {
            font-size: 1.1rem;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 0.6rem;
            margin-top: 2px;
        }

        .speed-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(40, 167, 69, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .speed-indicator.show {
            opacity: 1;
        }

        .auto-advance {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* iPad Pro optimizations */
        @media (min-width: 1024px) {
            .container {
                padding: 20px;
            }
            
            .title {
                font-size: 1.6rem;
            }
            
            .sentence-text {
                font-size: 1.6rem;
            }
            
            .quick-btn {
                padding: 14px;
                font-size: 1rem;
            }
        }

        .streak-counter {
            position: absolute;
            top: 5px;
            left: 10px;
            background: linear-gradient(45deg, #ff9a56, #ff6b6b);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">‚ö° Speed Handwriting Collector</h1>
        </div>

        <div class="mode-selector">
            <button class="mode-btn active" id="sentenceMode">üìù Sentences</button>
            <button class="mode-btn" id="wordMode">üî§ Words</button>
            <button class="mode-btn" id="letterMode">üî† Letters</button>
        </div>

        <div class="progress-section">
            <div class="progress-label">
                <span id="modeLabel">Sentence Mode</span>
                <span><span id="currentSample">0</span> / <span id="targetSamples">1000</span></span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="sentence-display">
            <div class="streak-counter" id="streakCounter">üî• 0</div>
            <div class="word-count" id="wordCount">3 words</div>
            <p class="sentence-text" id="sentenceText">Loading...</p>
            <div class="speed-indicator" id="speedIndicator">‚ö° Fast!</div>
            <div class="auto-advance" id="autoAdvance" style="display: none;">Auto-advance in 3s</div>
        </div>

        <div class="canvas-container" id="canvasContainer">
            <canvas id="drawingCanvas"></canvas>
            <canvas class="guidelines" id="guidelineCanvas"></canvas>
        </div>

        <div class="quick-controls">
            <button class="quick-btn quick-next" id="nextBtn">‚úÖ Next (Space)</button>
            <button class="quick-btn quick-clear" id="clearBtn">üóëÔ∏è Clear</button>
            <button class="quick-btn quick-skip" id="skipBtn">‚è≠Ô∏è Skip</button>
        </div>

        <div class="secondary-controls">
            <button class="btn btn-secondary" id="guidelinesBtn">Guidelines</button>
            <button class="btn btn-danger" id="exportBtn">üì§ Export</button>
        </div>

        <div class="stats">
            <div class="stat-card">
                <span class="stat-number" id="totalStrokes">0</span>
                <div class="stat-label">Strokes</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="totalWords">0</span>
                <div class="stat-label">Words</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="wpm">0</span>
                <div class="stat-label">WPM</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="dataSize">0KB</span>
                <div class="stat-label">Data</div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let canvas, ctx, guidelineCanvas, guidelineCtx;
        let isDrawing = false;
        let currentStroke = [];
        let allStrokes = [];
        let currentSampleData = [];
        let sampleCount = 0;
        let targetSamples = 1000;
        let startTime = Date.now();
        let totalStrokes = 0;
        let showGuidelines = true;
        let currentMode = 'sentence';
        let streak = 0;
        let lastSampleTime = Date.now();
        let sessionWordCount = 0;
        let autoAdvanceTimer = null;

        // Enhanced sentence collections
        const sentenceCollections = {
            sentence: [
                "Netflix and chill vibes", "Main character energy", "That hits different though",
                "No cap this is fire", "Living my best life", "Touch grass immediately",
                "Big mood honestly", "This is not it chief", "Sending good vibes only",
                "Pizza at midnight", "Coffee before conversation", "Tacos solve everything",
                "Ice cream breakfast", "Pasta love language", "Chocolate fixes days",
                "My plants judging", "Socks disappear dryers", "Monday energy questionable",
                "Dream big work", "Create own sunshine", "Adventure awaits beyond",
                "WiFi stronger relationships", "Phone battery anxiety", "Screenshot for evidence",
                "Clouds look thoughts", "Music speaks words", "Books portable magic",
                "Penguins wear tuxedos", "Unicorns are shy", "Dragons collect teacups"
            ],
            word: [
                "amazing", "brilliant", "creative", "dynamic", "fantastic", "gorgeous", "incredible",
                "pizza", "coffee", "music", "books", "travel", "friends", "family", "dreams",
                "happy", "excited", "motivated", "inspired", "grateful", "peaceful", "confident",
                "technology", "adventure", "mystery", "magic", "wonder", "discovery", "journey",
                "sunshine", "rainbow", "ocean", "mountain", "forest", "river", "sunset",
                "love", "hope", "faith", "trust", "kindness", "courage", "strength"
            ],
            letter: [
                "A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M",
                "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z",
                "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m",
                "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z",
                "0", "1", "2", "3", "4", "5", "6", "7", "8", "9"
            ]
        };

        function init() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            guidelineCanvas = document.getElementById('guidelineCanvas');
            guidelineCtx = guidelineCanvas.getContext('2d');

            resizeCanvas();
            setupCanvas();
            drawGuidelines();
            updateStats();
            loadContent();
            setupEventListeners();
            setupKeyboardShortcuts();
        }

        function setupEventListeners() {
            // Canvas events
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('touchend', handleTouchEnd, { passive: false });
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);

            // Button events
            document.getElementById('nextBtn').addEventListener('click', nextSample);
            document.getElementById('clearBtn').addEventListener('click', clearCanvas);
            document.getElementById('skipBtn').addEventListener('click', skipSample);
            document.getElementById('guidelinesBtn').addEventListener('click', toggleGuidelines);
            document.getElementById('exportBtn').addEventListener('click', exportData);

            // Mode buttons
            document.getElementById('sentenceMode').addEventListener('click', () => setMode('sentence'));
            document.getElementById('wordMode').addEventListener('click', () => setMode('word'));
            document.getElementById('letterMode').addEventListener('click', () => setMode('letter'));

            // Prevent scrolling
            document.addEventListener('touchstart', (e) => {
                if (e.target === canvas) e.preventDefault();
            }, { passive: false });
            document.addEventListener('touchmove', (e) => {
                if (e.target === canvas) e.preventDefault();
            }, { passive: false });

            // Resize handling
            window.addEventListener('orientationchange', () => {
                setTimeout(() => {
                    resizeCanvas();
                    drawGuidelines();
                }, 200);
            });
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space') {
                    e.preventDefault();
                    nextSample();
                } else if (e.code === 'KeyC') {
                    clearCanvas();
                } else if (e.code === 'KeyS') {
                    skipSample();
                }
            });
        }

        function setMode(mode) {
            currentMode = mode;
            
            // Update UI
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode + 'Mode').classList.add('active');
            
            // Update targets
            const targets = { sentence: 1000, word: 2000, letter: 3000 };
            targetSamples = targets[mode];
            document.getElementById('targetSamples').textContent = targetSamples;
            
            // Update label
            const labels = { sentence: 'Sentence Mode', word: 'Word Mode', letter: 'Letter Mode' };
            document.getElementById('modeLabel').textContent = labels[mode];
            
            loadContent();
            updateProgress();
        }

        function loadContent() {
            const collection = sentenceCollections[currentMode];
            const randomIndex = Math.floor(Math.random() * collection.length);
            const content = collection[randomIndex];
            
            document.getElementById('sentenceText').textContent = content;
            
            // Update word count
            const wordCount = currentMode === 'letter' ? '1 char' : 
                             currentMode === 'word' ? '1 word' : 
                             content.split(' ').length + ' words';
            document.getElementById('wordCount').textContent = wordCount;
            
            clearAutoAdvance();
        }

        function nextSample() {
            if (allStrokes.length === 0) {
                showSpeedFeedback('Write something first! ‚úçÔ∏è', 'warning');
                return;
            }

            // Save sample
            const currentText = document.getElementById('sentenceText').textContent;
            currentSampleData.push({
                text: currentText,
                strokes: allStrokes.map(stroke => stroke.map(point => [point.x, point.y])),
                timestamp: Date.now(),
                mode: currentMode
            });

            // Update counters
            sampleCount++;
            const wordsInSample = currentMode === 'letter' ? 0.2 : 
                                 currentMode === 'word' ? 1 : 
                                 currentText.split(' ').length;
            sessionWordCount += wordsInSample;

            // Speed feedback
            const currentTime = Date.now();
            const timeDiff = (currentTime - lastSampleTime) / 1000;
            if (timeDiff < 30) {
                streak++;
                showSpeedFeedback('‚ö° Speed demon!', 'success');
                
                // Auto-advance for fast users
                if (streak >= 3 && timeDiff < 15) {
                    startAutoAdvance();
                }
            } else {
                streak = 0;
            }
            lastSampleTime = currentTime;

            updateProgress();
            updateStats();
            clearCanvas();
            loadContent();
        }

        function skipSample() {
            loadContent();
            showSpeedFeedback('‚è≠Ô∏è Skipped', 'info');
        }

        function startAutoAdvance() {
            let countdown = 3;
            const autoAdvanceEl = document.getElementById('autoAdvance');
            autoAdvanceEl.style.display = 'block';
            
            autoAdvanceTimer = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    autoAdvanceEl.textContent = `Auto-advance in ${countdown}s`;
                } else {
                    clearAutoAdvance();
                    if (allStrokes.length > 0) {
                        nextSample();
                    }
                }
            }, 1000);
        }

        function clearAutoAdvance() {
            if (autoAdvanceTimer) {
                clearInterval(autoAdvanceTimer);
                autoAdvanceTimer = null;
            }
            document.getElementById('autoAdvance').style.display = 'none';
        }

        function showSpeedFeedback(message, type) {
            const indicator = document.getElementById('speedIndicator');
            indicator.textContent = message;
            indicator.className = 'speed-indicator show';
            
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        function resizeCanvas() {
            const container = document.getElementById('canvasContainer');
            const rect = container.getBoundingClientRect();
            
            canvas.width = Math.floor(rect.width);
            canvas.height = Math.floor(rect.height);
            guidelineCanvas.width = canvas.width;
            guidelineCanvas.height = canvas.height;
            
            setupCanvas();
        }

        function setupCanvas() {
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.imageSmoothingEnabled = true;
        }

        function getEventPos(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            let clientX, clientY;
            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            return {
                x: (clientX - rect.left) * scaleX,
                y: (clientY - rect.top) * scaleY
            };
        }

        function handleTouchStart(e) {
            e.preventDefault();
            clearAutoAdvance();
            startDrawing(getEventPos(e));
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (isDrawing) draw(getEventPos(e));
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            stopDrawing();
        }

        function handleMouseDown(e) {
            clearAutoAdvance();
            startDrawing(getEventPos(e));
        }

        function handleMouseMove(e) {
            if (isDrawing) draw(getEventPos(e));
        }

        function handleMouseUp(e) {
            stopDrawing();
        }

        function startDrawing(pos) {
            isDrawing = true;
            currentStroke = [{x: pos.x, y: pos.y, time: Date.now()}];
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        function draw(pos) {
            if (!isDrawing) return;
            
            if (currentStroke.length > 0) {
                const lastPoint = currentStroke[currentStroke.length - 1];
                const distance = Math.sqrt((pos.x - lastPoint.x) ** 2 + (pos.y - lastPoint.y) ** 2);
                if (distance < 2.0) return;
            }
            
            currentStroke.push({x: pos.x, y: pos.y, time: Date.now()});
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
        }

        function stopDrawing() {
            if (!isDrawing) return;
            isDrawing = false;
            
            if (currentStroke.length > 1) {
                allStrokes.push([...currentStroke]);
                totalStrokes++;
                updateStats();
            }
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            totalStrokes = totalStrokes - allStrokes.length;
            allStrokes = [];
            clearAutoAdvance();
            updateStats();
        }

        function drawGuidelines() {
            if (!showGuidelines) return;
            
            guidelineCtx.clearRect(0, 0, guidelineCanvas.width, guidelineCanvas.height);
            
            const height = guidelineCanvas.height;
            const width = guidelineCanvas.width;
            const margin = 30;
            
            // Simple guidelines for speed
            guidelineCtx.strokeStyle = '#cccccc';
            guidelineCtx.lineWidth = 1;
            
            // Baseline
            const baseline = height * 0.7;
            guidelineCtx.beginPath();
            guidelineCtx.moveTo(margin, baseline);
            guidelineCtx.lineTo(width - margin, baseline);
            guidelineCtx.stroke();
            
            // Top line
            const topline = height * 0.3;
            guidelineCtx.beginPath();
            guidelineCtx.moveTo(margin, topline);
            guidelineCtx.lineTo(width - margin, topline);
            guidelineCtx.stroke();
        }

        function toggleGuidelines() {
            showGuidelines = !showGuidelines;
            drawGuidelines();
        }

        function updateProgress() {
            const progress = (sampleCount / targetSamples) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('currentSample').textContent = sampleCount;
        }

        function updateStats() {
            document.getElementById('totalStrokes').textContent = totalStrokes;
            document.getElementById('totalWords').textContent = Math.floor(sessionWordCount);
            document.getElementById('streakCounter').textContent = 'üî• ' + streak;
            
            // Calculate WPM
            const sessionMinutes = (Date.now() - startTime) / 60000;
            const wpm = sessionMinutes > 0 ? Math.round(sessionWordCount / sessionMinutes) : 0;
            document.getElementById('wpm').textContent = wpm;
            
            const dataSize = Math.round((JSON.stringify(currentSampleData).length / 1024));
            document.getElementById('dataSize').textContent = dataSize + 'KB';
        }

        function exportData() {
            if (currentSampleData.length === 0) {
                alert('No data to export! Write some samples first.');
                return;
            }

            const exportData = {
                metadata: {
                    totalSamples: currentSampleData.length,
                    totalStrokes: totalStrokes,
                    sessionWords: Math.floor(sessionWordCount),
                    createdAt: new Date().toISOString(),
                    version: '2.0',
                    device: 'iPad',
                    modes: [...new Set(currentSampleData.map(s => s.mode))]
                },
                samples: currentSampleData
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `handwriting_data_${Date.now()}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            const fileSizeKB = Math.round(dataStr.length / 1024);
            alert(`‚úÖ Exported ${currentSampleData.length} samples (${fileSizeKB}KB)\nüöÄ Great job on your data collection!`);
        }

        // Initialize
        window.addEventListener('load', init);
        setInterval(updateStats, 10000);
    </script>
</body>
</html>
